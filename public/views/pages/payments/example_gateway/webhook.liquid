---
method: post
---
{% liquid
  if context.params.payment_status == 'success_delayed'
    assign object = context.params | hash_merge: payment_status: 'success', valid: true
    background _ = 'modules/payments_example_gateway/commands/update_transaction_status', object: object, delay: 0.25
  else
    function object = 'modules/payments_example_gateway/commands/update_transaction_status', object: context.params
  endif
  if object.valid
    assign url = '/' | append: return_url | append: '?id=' | append: context.params.transaction_id
    include 'redirect_to', url: url
  else
    log object, type: 'ERROR: payments_example_gateway webhook'
  endif
%}
