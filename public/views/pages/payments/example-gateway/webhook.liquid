---
method: post
---
{% liquid
  if context.params.payment_status == 'success_delayed'
    assign object = context.params | hash_merge: payment_status: 'success', valid: true
    background _ = 'lib/commands/example_gateway/update_transaction_status', object: object, delay: 0.25
  else
    function object = 'lib/commands/example_gateway/update_transaction_status', object: context.params
  endif
  if object.valid
    assign url = '/orders/status?id=' | append: context.params.transaction_id
    include 'redirect_to', url: url
  else
    log object, type: 'example_payment_gateway webhook'
  endif
%}
